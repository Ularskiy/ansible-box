- name: Полная и гибкая настройка дисков для нескольких хостов
  hosts: all 
  become: true
  pre_tasks:
    - name: Установить утилиты для работы с дисками (LVM, XFS, Parted)
      ansible.builtin.package:
        name:
          - lvm2
          - xfsprogs
          - parted
        state: present

  vars:
    disk_configs_by_host:
      '192.168.157.194':
        - operation_type: extend
          disk_device: /dev/sda  # Используем свободное место на sda
          vg_to_extend: rhel
          lvs_to_modify:
            - name: root
              new_size: 50G
              filesystem: /
              allow_dangerous_resize: true 

            - name: log_lv
              new_size: 100G
              filesystem: /var/log
              fs_type: xfs
    disks: "{{ disk_configs_by_host[inventory_hostname] | default([]) }}"


  roles:
    - role: infra/fix-repository
      fix_repository_exit_on_success: false 

    - role: infra/manage-disks
